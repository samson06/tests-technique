/*  -----------------------------
	-- Manage cinema Event DDL : 
  -------------------------------
*/
 
-- Suppression des tables et contraintes associées
DROP TABLE IF EXISTS BAND_MEMBERS CASCADE;
DROP TABLE IF EXISTS EVENT_BANDS CASCADE;
DROP TABLE IF EXISTS MEMBER CASCADE;
DROP TABLE IF EXISTS BAND CASCADE;
DROP TABLE IF EXISTS EVENT CASCADE;

-- ---------------------- 
-- Création des Tables : 
-- ---------------------- 
--  BAND
CREATE TABLE BAND(
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1),
	NAME VARCHAR(255),
	PRIMARY KEY (ID)
);
--  MEMBER
CREATE TABLE MEMBER(
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1),
	NAME VARCHAR(255),
	PRIMARY KEY (ID)
);
--  BAND_MEMBERS
CREATE TABLE BAND_MEMBERS (
	BAND_ID BIGINT NOT NULL,
	MEMBERS_ID BIGINT NOT NULL,
	PRIMARY KEY (BAND_ID, MEMBERS_ID)
);
--  EVENT
CREATE TABLE EVENT (
	ID BIGINT GENERATED BY DEFAULT AS IDENTITY (START WITH 1),
	EVT_COMMENT VARCHAR(255),
	IMG_URL VARCHAR(255),
	NB_STARS INTEGER,
	TITLE VARCHAR(255),
	PRIMARY KEY (ID)
);
--  EVENT_BANDS
create table EVENT_BANDS (
	EVENT_ID BIGINT NOT NULL,
	BANDS_ID BIGINT NOT NULL,
	PRIMARY KEY (EVENT_ID, BANDS_ID)
);

-- -----------------------------------------------------------
-- Création des contraintes associées aux différentes tables :
-- -----------------------------------------------------------
-- Contraintes de clés étrangères pour la table BAND_MEMBERS en provenance de MEMBER et de BAND
ALTER TABLE BAND_MEMBERS 
	ADD CONSTRAINT FK551i3sllw1wj7ex6nir16blse FOREIGN KEY (MEMBERS_ID)  REFERENCES MEMBER;
ALTER TABLE BAND_MEMBERS 
	ADD CONSTRAINT FK551i3sllw1wj7ex6nir16blsf FOREIGN KEY (BAND_ID) REFERENCES BAND;
-- Contraintes de clés étrangères pour la table EVENT_BANDS	 en provenance de EVENT et de BAND
ALTER TABLE EVENT_BANDS 
	ADD CONSTRAINT FK551i3sllw1wj7ex6nir16blsm FOREIGN KEY (BANDS_ID) REFERENCES BAND;
ALTER TABLE EVENT_BANDS
	ADD CONSTRAINT FKs4xm7q8i3uxvaiswj1c35nnxw FOREIGN KEY (EVENT_ID) REFERENCES EVENT;